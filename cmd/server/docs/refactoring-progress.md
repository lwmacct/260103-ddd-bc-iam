# DDD å‚ç›´åˆ‡åˆ†é‡æ„è¿›åº¦

> **é‡æ„å¼€å§‹æ—¶é—´**ï¼š2026-01-02
> **é¢„è®¡å®Œæˆæ—¶é—´**ï¼šTBD
> **å½“å‰çŠ¶æ€**ï¼šè§„åˆ’é˜¶æ®µ âœ…

---

## æ€»ä½“è¿›åº¦

```
[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100% Phase 0: è§„åˆ’ âœ…
[â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]   0% Phase 1: éª¨æ¶åˆ›å»º
[â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]   0% Phase 2: Platform å±‚
[â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]   0% Phase 3: Core BC
[â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]   0% Phase 4: IAM BC
[â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]   0% Phase 5: CRM BC
[â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]   0% Phase 6: DI å®¹å™¨
[â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]   0% Phase 7: Bootstrap
[â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]   0% Phase 8: Kit é—¨é¢
[â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]   0% Phase 9: Import æ›´æ–°
[â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]   0% Phase 10: éªŒè¯
[â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]   0% Phase 11: æ¸…ç†
```

---

## Phase 0: è§„åˆ’é˜¶æ®µ âœ…

**ç›®æ ‡**ï¼šåˆ†æå½“å‰æ¶æ„ï¼Œåˆ¶å®šè¯¦ç»†é‡æ„è®¡åˆ’

- [x] åˆ†æå½“å‰ç›®å½•ç»“æ„
- [x] è¯†åˆ«ä¾èµ–å…³ç³»
- [x] åˆ›å»ºé‡æ„è®¡åˆ’æ–‡æ¡£ (`docs/refactoring-plan.md`)
- [x] åˆ›å»ºè¾…åŠ©è„šæœ¬
  - [x] `scripts/migrate-scaffold.sh` - éª¨æ¶åˆ›å»ºè„šæœ¬
  - [x] `scripts/migrate-imports.sh` - Import æ›¿æ¢è„šæœ¬
- [x] åˆ›å»ºè¿›åº¦è·Ÿè¸ªæ–‡æ¡£ (`docs/refactoring-progress.md`)

**äº§å‡º**ï¼š

- `docs/refactoring-plan.md` - è¯¦ç»†é‡æ„è®¡åˆ’
- `docs/refactoring-progress.md` - æœ¬æ–‡æ¡£
- `scripts/migrate-scaffold.sh` - éª¨æ¶åˆ›å»ºè„šæœ¬
- `scripts/migrate-imports.sh` - Import æ›¿æ¢è„šæœ¬

**éªŒè¯**ï¼š

- [x] è®¡åˆ’æ–‡æ¡£å®Œæ•´
- [x] è„šæœ¬å¯æ‰§è¡Œ

---

## Phase 1: åˆ›å»ºéª¨æ¶ç»“æ„

**ç›®æ ‡**ï¼šåˆ›å»ºæ–°ç›®å½•ç»“æ„éª¨æ¶ï¼Œæš‚ä¸è¿ç§»ä»£ç 

- [ ] æ‰§è¡Œ `scripts/migrate-scaffold.sh`
- [ ] éªŒè¯ç›®å½•ç»“æ„æ­£ç¡®
- [ ] åˆ›å»ºå ä½ç¬¦ `doc.go`

**éªŒè¯**ï¼š

- [ ] `ls -la pkg/platform/` - 7 ä¸ªå­ç›®å½•
- [ ] `ls -la pkg/modules/{core,iam,crm}/` - 3 ä¸ª BC
- [ ] `ls -la internal/app/` - 3 ä¸ªå­ç›®å½•

---

## Phase 2: æå– Platform å±‚

**ç›®æ ‡**ï¼šå°† `ddd/core/infrastructure` çš„æŠ€æœ¯ç»„ä»¶è¿ç§»åˆ° `pkg/platform`

### å­ä»»åŠ¡

- [ ] **Database** (`pkg/platform/db`)
  - [ ] è¿ç§» `ddd/core/infrastructure/database` â†’ `pkg/platform/db`
  - [ ] æ›´æ–° import è·¯å¾„
  - [ ] éªŒè¯ç¼–è¯‘

- [ ] **Cache** (`pkg/platform/cache`)
  - [ ] è¿ç§» `ddd/core/infrastructure/cache` â†’ `pkg/platform/cache`
  - [ ] æ›´æ–° import è·¯å¾„
  - [ ] éªŒè¯ç¼–è¯‘

- [ ] **EventBus** (`pkg/platform/eventbus`)
  - [ ] è¿ç§» `ddd/core/infrastructure/eventbus` â†’ `pkg/platform/eventbus`
  - [ ] æ›´æ–° import è·¯å¾„
  - [ ] éªŒè¯ç¼–è¯‘

- [ ] **Queue** (`pkg/platform/queue`)
  - [ ] è¿ç§» `ddd/core/infrastructure/queue` â†’ `pkg/platform/queue`
  - [ ] æ›´æ–° import è·¯å¾„
  - [ ] éªŒè¯ç¼–è¯‘

- [ ] **Telemetry** (`pkg/platform/telemetry`)
  - [ ] è¿ç§» `ddd/core/infrastructure/telemetry` â†’ `pkg/platform/telemetry`
  - [ ] æ›´æ–° import è·¯å¾„
  - [ ] éªŒè¯ç¼–è¯‘

- [ ] **Validation** (`pkg/platform/validation`)
  - [ ] è¿ç§» `ddd/core/infrastructure/validation` â†’ `pkg/platform/validation`
  - [ ] æ›´æ–° import è·¯å¾„
  - [ ] éªŒè¯ç¼–è¯‘

- [ ] **Health** (`pkg/platform/health`)
  - [ ] è¿ç§» `ddd/core/infrastructure/health` â†’ `pkg/platform/health`
  - [ ] æ›´æ–° import è·¯å¾„
  - [ ] éªŒè¯ç¼–è¯‘

**éªŒè¯**ï¼š

- [ ] `go build -o /dev/null ./...`
- [ ] `go test ./pkg/platform/...`

---

## Phase 3: è¿ç§» Core BC

**ç›®æ ‡**ï¼šå°† `ddd/core` è¿ç§»åˆ° `pkg/modules/app`

### 3.1 Domain å±‚

- [ ] è¿ç§» `ddd/core/domain/audit` â†’ `pkg/modules/app/domain/audit`
- [ ] è¿ç§» `ddd/core/domain/org` â†’ `pkg/modules/app/domain/org`
- [ ] è¿ç§» `ddd/core/domain/setting` â†’ `pkg/modules/app/domain/setting`
- [ ] è¿ç§» `ddd/core/domain/stats` â†’ `pkg/modules/app/domain/stats`
- [ ] è¿ç§» `ddd/core/domain/task` â†’ `pkg/modules/app/domain/task`
- [ ] è¿ç§» `ddd/core/domain/cache` â†’ `pkg/shared/cache`
- [ ] è¿ç§» `ddd/core/domain/captcha` â†’ `pkg/shared/captcha`
- [ ] è¿ç§» `ddd/core/domain/health` â†’ `pkg/shared/health`
- [ ] è¿ç§» `ddd/core/domain/event` â†’ `pkg/shared/event`

### 3.2 Application å±‚

- [ ] è¿ç§» `ddd/core/application/audit` â†’ `pkg/modules/app/application/audit`
- [ ] è¿ç§» `ddd/core/application/org` â†’ `pkg/modules/app/application/org`
- [ ] è¿ç§» `ddd/core/application/setting` â†’ `pkg/modules/app/application/setting`
- [ ] è¿ç§» `ddd/core/application/stats` â†’ `pkg/modules/app/application/stats`
- [ ] è¿ç§» `ddd/core/application/task` â†’ `pkg/modules/app/application/task`
- [ ] è¿ç§» `ddd/core/application/cache` â†’ `pkg/modules/app/application/cache`
- [ ] è¿ç§» `ddd/core/application/captcha` â†’ `pkg/modules/app/application/captcha`
- [ ] è¿ç§» `ddd/core/application/health` â†’ `pkg/modules/app/application/health`

### 3.3 Infrastructure å±‚

- [ ] è¿ç§» `ddd/core/infrastructure/persistence` â†’ `pkg/modules/app/infrastructure/persistence`
- [ ] è¿ç§» `ddd/core/infrastructure/database/seeds` â†’ `pkg/modules/app/migrations`

### 3.4 Transport å±‚

- [ ] è¿ç§» `ddd/core/adapters/http/handler` â†’ `pkg/modules/app/transport/gin/handler`
- [ ] è¿ç§» `ddd/core/adapters/http/routes` â†’ `pkg/modules/app/transport/gin/routes`
- [ ] è¿ç§» `ddd/core/adapters/http/middleware` â†’ `pkg/modules/app/transport/gin/middleware`
- [ ] è¿ç§» `ddd/core/adapters/http/router.go` â†’ `pkg/modules/app/transport/gin/router.go`
- [ ] è¿ç§» `ddd/core/adapters/http/server.go` â†’ `pkg/modules/app/transport/gin/server.go`

### 3.5 Module Entry

- [ ] åˆ›å»º `pkg/modules/app/module.go`

**éªŒè¯**ï¼š

- [ ] `go build -o /dev/null ./...`
- [ ] `go test ./pkg/modules/app/...`

---

## Phase 4: è¿ç§» IAM BC

**ç›®æ ‡**ï¼šå°† `ddd/iam` è¿ç§»åˆ° `pkg/modules/iam`

### 4.1 Domain å±‚

- [ ] è¿ç§» `ddd/iam/domain/auth` â†’ `pkg/modules/iam/domain/auth`
- [ ] è¿ç§» `ddd/iam/domain/pat` â†’ `pkg/modules/iam/domain/pat`
- [ ] è¿ç§» `ddd/iam/domain/role` â†’ `pkg/modules/iam/domain/role`
- [ ] è¿ç§» `ddd/iam/domain/twofa` â†’ `pkg/modules/iam/domain/twofa`
- [ ] è¿ç§» `ddd/iam/domain/user` â†’ `pkg/modules/iam/domain/user`

### 4.2 Application å±‚

- [ ] è¿ç§» `ddd/iam/application/auth` â†’ `pkg/modules/iam/application/auth`
- [ ] è¿ç§» `ddd/iam/application/pat` â†’ `pkg/modules/iam/application/pat`
- [ ] è¿ç§» `ddd/iam/application/role` â†’ `pkg/modules/iam/application/role`
- [ ] è¿ç§» `ddd/iam/application/twofa` â†’ `pkg/modules/iam/application/twofa`
- [ ] è¿ç§» `ddd/iam/application/user` â†’ `pkg/modules/iam/application/user`

### 4.3 Infrastructure å±‚

- [ ] è¿ç§» `ddd/iam/infrastructure/auth` â†’ `pkg/modules/iam/infrastructure/auth`
- [ ] è¿ç§» `ddd/iam/infrastructure/twofa` â†’ `pkg/modules/iam/infrastructure/twofa`
- [ ] ä» `ddd/core/infrastructure/persistence` ä¸­æå– IAM ç›¸å…³ä»“å‚¨ â†’ `pkg/modules/iam/infrastructure/persistence`

### 4.4 Transport å±‚

- [ ] è¿ç§» `ddd/iam/adapters/http/handler` â†’ `pkg/modules/iam/transport/gin/handler`

### 4.5 Module Entry

- [ ] åˆ›å»º `pkg/modules/iam/module.go`

**éªŒè¯**ï¼š

- [ ] `go build -o /dev/null ./...`
- [ ] `go test ./pkg/modules/iam/...`

---

## Phase 5: è¿ç§» CRM BC

**ç›®æ ‡**ï¼šå°† `ddd/crm` è¿ç§»åˆ° `pkg/modules/crm`

### 5.1 Domain å±‚

- [ ] è¿ç§» `ddd/crm/domain/company` â†’ `pkg/modules/crm/domain/company`
- [ ] è¿ç§» `ddd/crm/domain/contact` â†’ `pkg/modules/crm/domain/contact`
- [ ] è¿ç§» `ddd/crm/domain/lead` â†’ `pkg/modules/crm/domain/lead`
- [ ] è¿ç§» `ddd/crm/domain/opportunity` â†’ `pkg/modules/crm/domain/opportunity`

### 5.2 Application å±‚

- [ ] è¿ç§» `ddd/crm/application/company` â†’ `pkg/modules/crm/application/company`
- [ ] è¿ç§» `ddd/crm/application/contact` â†’ `pkg/modules/crm/application/contact`
- [ ] è¿ç§» `ddd/crm/application/lead` â†’ `pkg/modules/crm/application/lead`
- [ ] è¿ç§» `ddd/crm/application/opportunity` â†’ `pkg/modules/crm/application/opportunity`

### 5.3 Infrastructure å±‚

- [ ] è¿ç§» `ddd/crm/infrastructure/persistence` â†’ `pkg/modules/crm/infrastructure/persistence`

### 5.4 Module Entry

- [ ] åˆ›å»º `pkg/modules/crm/module.go`

**éªŒè¯**ï¼š

- [ ] `go build -o /dev/null ./...`
- [ ] `go test ./pkg/modules/crm/...`

---

## Phase 6: é‡æ„ DI å®¹å™¨

**ç›®æ ‡**ï¼šå°† `internal/container` æ”¹é€ ä¸º `internal/app/di`

- [ ] åˆ›å»º `internal/app/di/infra.go` - è£…é… `pkg/platform/*`
- [ ] åˆ›å»º `internal/app/di/module.go` - è£…é… `pkg/modules/*`
- [ ] åˆ›å»º `internal/app/di/http.go` - è£…é… HTTP Transport
- [ ] è¿ç§» `internal/container/hooks.go` â†’ `internal/app/di/hooks.go`
- [ ] æ›´æ–° `cmd/server/main.go` çš„å¼•ç”¨

**éªŒè¯**ï¼š

- [ ] `go build -o /dev/null ./...`
- [ ] `timeout 3 go run . api` - éªŒè¯ DI æˆåŠŸ

---

## Phase 7: åˆ›å»º Bootstrap

**ç›®æ ‡**ï¼šå°† HTTP Server å¯åŠ¨é€»è¾‘ç‹¬ç«‹åˆ° `internal/app/bootstrap`

- [ ] åˆ›å»º `internal/app/bootstrap/engine.go`
- [ ] åˆ›å»º `internal/app/bootstrap/middleware.go`
- [ ] åˆ›å»º `internal/app/bootstrap/server.go`

**éªŒè¯**ï¼š

- [ ] `go build -o /dev/null ./...`
- [ ] `timeout 3 go run . api` - éªŒè¯æœåŠ¡å™¨å¯åŠ¨

---

## Phase 8: åˆ›å»º Kit é—¨é¢

**ç›®æ ‡**ï¼šæä¾›ç®€åŒ–çš„ API ä¾›å¤–éƒ¨é¡¹ç›®ä½¿ç”¨

- [ ] åˆ›å»º `pkg/kit/platform/db.go`
- [ ] åˆ›å»º `pkg/kit/platform/cache.go`
- [ ] åˆ›å»º `pkg/kit/platform/eventbus.go`
- [ ] åˆ›å»º `pkg/kit/modules/app.go`
- [ ] åˆ›å»º `pkg/kit/modules/iam.go`
- [ ] åˆ›å»º `pkg/kit/modules/crm.go`

**éªŒè¯**ï¼š

- [ ] `go doc ./pkg/kit/...`

---

## Phase 9: æ›´æ–° Import è·¯å¾„

**ç›®æ ‡**ï¼šå…¨å±€æ‰¹é‡æ›¿æ¢ import è·¯å¾„

- [ ] æ‰§è¡Œ `scripts/migrate-imports.sh`
- [ ] æ£€æŸ¥ `git diff` ç¡®è®¤æ›¿æ¢æ­£ç¡®
- [ ] æ‰‹åŠ¨ä¿®å¤ç‰¹æ®Šè·¯å¾„

**éªŒè¯**ï¼š

- [ ] `git diff --stat`
- [ ] `go build -o /dev/null ./...`

---

## Phase 10: éªŒè¯ä¸ä¿®å¤

**ç›®æ ‡**ï¼šç¡®ä¿ç¼–è¯‘é€šè¿‡å’Œæµ‹è¯•é€šè¿‡

- [ ] `go build -o /dev/null ./...`
- [ ] `go test ./...`
- [ ] `golangci-lint run --new`
- [ ] `MANUAL=1 go test -v ./internal/manualtest/...`

**ä¿®å¤æ¸…å•**ï¼š

- [ ] ä¿®å¤ç¼–è¯‘é”™è¯¯
- [ ] ä¿®å¤æµ‹è¯•å¤±è´¥
- [ ] ä¿®å¤ Linter è­¦å‘Š
- [ ] ä¿®å¤é›†æˆæµ‹è¯•å¤±è´¥

---

## Phase 11: æ¸…ç†æ—§ç›®å½•

**ç›®æ ‡**ï¼šåˆ é™¤å·²è¿ç§»çš„æ—§ç›®å½•

- [ ] åˆ é™¤ `ddd/core`
- [ ] åˆ é™¤ `ddd/iam`
- [ ] åˆ é™¤ `ddd/crm`
- [ ] åˆ é™¤ `ddd` ç›®å½•
- [ ] åˆ é™¤ `internal/container`

**éªŒè¯**ï¼š

- [ ] `go build -o /dev/null ./...`
- [ ] `go test ./...`

---

## é—®é¢˜è·Ÿè¸ª

| ID  | é—®é¢˜ | çŠ¶æ€ | è§£å†³æ–¹æ¡ˆ |
| --- | ---- | ---- | -------- |
| -   | -    | -    | -        |

---

## å‚è€ƒèµ„æº

- ğŸ“„ [é‡æ„è®¡åˆ’è¯¦æƒ…](./refactoring-plan.md)
- ğŸ› ï¸ [éª¨æ¶åˆ›å»ºè„šæœ¬](../scripts/migrate-scaffold.sh)
- ğŸ› ï¸ [Import æ›¿æ¢è„šæœ¬](../scripts/migrate-imports.sh)

---

**æœ€åæ›´æ–°**ï¼š2026-01-02
